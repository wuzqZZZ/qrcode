{"version":3,"sources":["../../src/pages/paper/paperinfosearch/collectionfile/collectionfile.ts","../../src/pages/paper/paperinfosearch/collectionfile/collectionfile.module.ts"],"names":[],"mappings":"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","file":"30.js","sourcesContent":["import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams,MenuController,Events , Platform, ToastController} from 'ionic-angular';\nimport { HttpServicesProvider } from '../../../../providers/http-services';\nimport { Utils } from \"../../../../providers/Utils\";\nimport { PhoneDeviceProvider } from '../../../../providers/phone-device';\nimport { StorageProvider } from '../../../../providers/storage';\nimport { FileTransfer,FileTransferObject } from '@ionic-native/file-transfer';\nimport { AndroidPermissions } from '@ionic-native/android-permissions';\nimport { FileOpener } from '@ionic-native/file-opener';\nimport { File } from '@ionic-native/file';\nimport { ConfigProvider } from '../../../../providers/config';\nimport { LoadingController, Loading } from 'ionic-angular';\n/**\n * Generated class for the CollectionfilePage page.\n *\n * See https://ionicframework.com/docs/components/#navigation for more info on\n * Ionic pages and navigation.\n */\n\n@IonicPage()\n@Component({\n  selector: 'page-collectionfile',\n  templateUrl: 'collectionfile.html',\n})\nexport class CollectionfilePage {\n  public event: any;\n  public filepath='';\n  public list=[];//列表\n  public dataList = []; //缓存页码数据（上拉加载）\n\tpublic mCurrentPage = 0;//默认page\n  public where='';//搜索\n  public stops='';//无数据加载完毕\n  public id = '';\n  public records = '0';\n  public description = '';\n  public fuzzysearch = '';\n  constructor(public navCtrl: NavController, public navParams: NavParams,\n    public menuCtrl: MenuController,\n    public httpService: HttpServicesProvider,\n    public phonedevice:PhoneDeviceProvider,\n    public events: Events,\n    public storage: StorageProvider,\n    public platform:Platform,\n    public toastCtrl:ToastController,\n    public transfer: FileTransfer,\n    public permission:AndroidPermissions,\n    public fileopen:FileOpener,\n    public file:File,\n    public loadingCtrl: LoadingController) {\n      this.phonedevice.phoneBacktoPop(this.navCtrl);\n\n  }\n  finddescription(){\n    if(this.description != ''){\n      var fuzzysearch =   encodeURIComponent(this.description);\n      this.fuzzysearch = fuzzysearch;\n        // this.initdata(fuzzysearch)\n      }else{\n        this.fuzzysearch = '';\n      }\n      this.list = [];\n      this.initlist(1,this.where)\n  }\n  ionViewDidLoad() {\n    console.log('ionViewDidLoad CollectionfilePage');\n    this.initlist(1,'')\n  }\n  initlist(page,where){//初始化列表\n    let userinfo = this.storage.get(StorageProvider.ME_USERINFO);//读取登录人的储存信息\n  // console.log(userinfo)\n  \n    var url = '/paperCollect/list?sort=updatetime&order=desc&userId='+userinfo.id+'&_search=false&rows=15&page='+page+'&sidx=&sord=asc&fuzzysearch='+this.fuzzysearch;\n    var that = this;\n    var lists = this.list;\n    that.httpService.get(url, null, (result) => {\n        if(page > result.total){\n          this.stops = 'true';\n          return false;\n        }else{\n          this.stops = '';\n        }\n        this.records = result.records;\n        console.log(result)\n      if (result != null && result.rows.length > 0) {\n        var rows = result.rows;\n        for(let i=0;i<rows.length;i++){\n          rows[i].papertype =  rows[i].papertype.toLowerCase().replace(\".\",\"\")\n          rows[i].downUrl = '/paperInfo/download/download/'+rows[i].paperid\n        }\n          that.dataList = rows;\n          lists = lists.concat( that.dataList);\n          that.list = lists;\n          that.mCurrentPage = page;\n      }\n    });\n  }\n  checkPermissions() {\n    this.permission.requestPermission(this.permission.PERMISSION.READ_EXTERNAL_STORAGE).then(res => { console.log(res) });\n    this.permission.requestPermission(this.permission.PERMISSION.WRITE_EXTERNAL_STORAGE).then(res => { console.log(res) });\n  }\n  openFile(item){\n    console.log(item)\n    \n    item['url'] =ConfigProvider.apiUrl+ item['downUrl']\n    // item['url'] =Utils.dealUrl('/attach/download/paperinfo/073b393ffd2c4bf096df6d57c5ca1448')\n    // \"/bkc/attach/download/paperinfo/073b393ffd2c4bf096df6d57c5ca1448\"\n    // console.log(item['url'])\n    if(item.papertype == 'gif'  || item.papertype == 'jpg' || item.papertype == 'jpeg' || item.papertype == 'png'|| item.papertype == 'bmp' )\n    {\n      this.phonedevice.showBigimage(item['url']);\n    }else{\n      let loading = this.loadingCtrl.create({\n        content: '下载中，请稍等...',//数据加载中显示\n        enableBackdropDismiss:true,\n    });\n        loading.present();\n        let now = 0;  \n        var url = item['url'];\n      let name = item['papername'];\n\n        console.log(url);\n        if(this.platform.is('ios')){\n          this.filepath=this.file.dataDirectory+item['url'];\n        }else{  \n          if(item['papername'].substr(0,1) == '#'){\n            name = name.replace('#', ' ')\n          }\n          if(name.lastIndexOf('.') != -1){\n            this.filepath = this.file.externalApplicationStorageDirectory + name;\n          }else{\n            this.filepath = this.file.externalApplicationStorageDirectory + name+'.'+item['papertype'];\n          }\n\n        }\n        let filetransfer: FileTransferObject = this.transfer.create();\n        filetransfer.onProgress((progressEvent) => {\n          if (progressEvent.lengthComputable) {\n            now = progressEvent.loaded / progressEvent.total * 100;\n          }\n        })\n        filetransfer.download(url, this.filepath, true).then(() => {\n          this.checkPermissions();\n          loading.dismiss();\n          this.fileopen.open(this.filepath, this.httpService.getFileMimeType(item['papertype'])).then((data) => {\n            \n          }, (err) => {\n            loading.dismiss();\n            this.toastCtrl.create({\n              position: 'middle',\n              message: '文件打开失败/无'+ this.httpService.getFileMimeType(item['papertype'])+'查看器',\n              duration: 2000\n            }).present();\n          })\n        }, (err) => {\n          loading.dismiss();\n          this.toastCtrl.create({\n            position: 'middle',\n            message: '文件下载失败',\n            duration: 2000\n          }).present();\n        })\n    }\n  }\n  doRefresh(refresher) {//下拉刷新\n    this.list =[];\n      this.initlist(1,this.where)\n    setTimeout(()=>{\n      refresher.complete(); //停止下拉刷新\n      },2000)\n    }\n    doInfinite(infiniteScroll){//上拉加载\n          this.initlist(this.mCurrentPage + 1 ,this.where)\n        infiniteScroll.complete();//停止上拉加载\n        if(this.stops == 'true'){\n          infiniteScroll.enable(false);//停止上拉加载\n        }\n        // infiniteScroll.enable(false);//停止上拉加载\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/paper/paperinfosearch/collectionfile/collectionfile.ts","import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CollectionfilePage } from './collectionfile';\n\n@NgModule({\n  declarations: [\n    CollectionfilePage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CollectionfilePage),\n  ],\n})\nexport class CollectionfilePageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/paper/paperinfosearch/collectionfile/collectionfile.module.ts"],"sourceRoot":""}